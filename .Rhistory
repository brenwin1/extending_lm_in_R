z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
scatter_3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
scatter_3d
scatter_3d
scatter_3d$points3d(x = wcgs$height,
y = pred_grid$cigs)
scatter_3d$points3d(x = wcgs$height,
y = wcgs$cigs,
z = wcgs$chd)
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
scatter_3d$points3d(x = wcgs$height,
y = wcgs$cigs,
z = wcgs$chd)
scatter_3d$points3d(x = wcgs$height,
y = wcgs$cigs,
z = wcgs$chd,
pch = 16)
scatter_3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
scatter_3d$points3d(x = wcgs$height,
y = wcgs$cigs,
z = wcgs$chd,
pch = 16)
scatter_3d$points3d(x = wcgs$height,
y = wcgs$cigs,
z = wcgs$chd,
pch = 16)
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
scatter_3d$points3d(x = wcgs$height,
y = wcgs$cigs,
z = wcgs$chd,
pch = 16)
# overlay observations
scatter_3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
scatter_3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
wcgs$height
scatter_3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
scatter_3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
scatter_3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
scatter_3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
scatter_3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
s3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
s3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$chd,
pch = 16)
wcgs$chd
s3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$y,
pch = 16)
s3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
wcgs$y,
pch = 16)
pred_grid %>%
mutate(lm_pred = -4.50161397 + 0.02520779*height + 0.02312740*cigs)
pred_grid
pred_grid
pred_grid %>%
lm_pred
pred_grid %>% summary()
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
wcgs
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
pred_grid$lm_pred,
pch = 16)
pred_grid
wcgs
augment(log_mod)
broom::augment(log_mod)
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
broom::augment(log_mod)$.fitted,
pch = 16)
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
broom::augment(log_mod)$.fitted,
pch = 16)
broom::augment(log_mod)
broom::augment(log_mod)
broom::augment(log_mod) %>% summary()
pred_grid %>% summary()
height <- seq(from = 60, to = 90, by = 0.5)
cigs <- seq(from = 0, to = 100, by = 1)
pred_grid <- expand.grid(height = height, cigs = cigs)
pred_grid <- pred_grid %>%
mutate(lm_pred = -4.50161397 + 0.02520779*height + 0.02312740*cigs)
s3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
broom::augment(log_mod)$.fitted,
pch = 16)
s3d <- scatterplot3d::scatterplot3d(x = pred_grid$height,
y = pred_grid$cigs,
z = pred_grid$lm_pred,
angle = 60,
color = "dodgerblue",
pch = 1,  # point symbol
xlab = "height (in)",
ylab = "cigs",
zlab = "chd")
# overlay observations
s3d$points3d(wcgs$height,
wcgs$cigs,
broom::augment(log_mod)$.fitted,
pch = 16)
wcgs %>%
mutate(residuals = residuals(log_mod))
augment(log_mod)
broom::augment(log_mod)
library(broom)
wcgs %>%
mutate(residuals = residuals(log_mod))
predict(log_mod)
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod))
quantile(lin_pred,
(1:100)/101))
quantile(lin_pred,
(1:100)/101)
unique(quantile(lin_pred,
(1:100)/101))
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(linpred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101))))
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(linpred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101))))
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101))))
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuas = mean(residuals),
linpred = mean(lin_pred))
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuas = mean(residuals),
linpred = mean(lin_pred)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(residuals),
linpred = mean(lin_pred)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
gdf <- wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(residuals),
linpred = mean(lin_pred))
gdf %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
plot(residuals ~ lin_pred)
plot(residuals ~ lin_pred,
data = gdf)
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(residuals),
linpred = mean(lin_pred))
gdf <- wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(residuals),
lin_pred = mean(lin_pred))
plot(residuals ~ lin_pred,
data = gdf)
gdf %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
gdf %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals)) +
theme_bw()
broom::augment(log_mod) %>%
ggplot() +
geom_point(aes(x = .fitted,
y = .resid))
broom::augment(log_mod)
wcgs %>%
mutate(residuals = residuals(log_mod),
lin_pred = predict(log_mod)) %>%  # fitted values; on log(odds) scale
# create bins
group_by(cut(lin_pred, # divide variable into factors
breaks = unique(quantile(lin_pred, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101))))
broom::augment(log_mod)
ggplot() +
geom_point(aes(x = .fitted,
y = .resid))
broom::augment(log_mod) %>%
group_by(cut(.fitted, # divide variable into factors
breaks = unique(quantile(.fitted, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
ggplot() +
geom_point(aes(x = .fitted,
y = .resid))
broom::augment(log_mod) %>%
group_by(cut(.fitted, # divide variable into factors
breaks = unique(quantile(.fitted, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(residuals),
lin_pred = mean(.fitted)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = .resid))
broom::augment(log_mod) %>%
group_by(cut(.fitted, # divide variable into factors
breaks = unique(quantile(.fitted, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(residuals),
lin_pred = mean(.fitted)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
broom::augment(log_mod) %>%
group_by(cut(.fitted, # divide variable into factors
breaks = unique(quantile(.fitted, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(.resid),
lin_pred = mean(.fitted)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
broom::augment(log_mod) %>%
group_by(cut(.fitted, # divide variable into factors
breaks = unique(quantile(.fitted, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>%
summarise(residuals = mean(.resid),
lin_pred = mean(.fitted)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
(1:100)/101
quantcut(augment(log_mod)$.fitted)
gtools::quantcut(augment(log_mod)$.fitted)
gtools::quantcut(augment(log_mod)$.fitted, q = 4)
broom::augment(log_mod)
broom::augment(log_mod) %>%
group_by(cut(.fitted, # divide variable into factors
breaks = unique(quantile(.fitted, # breakpoints (divide based on quantiles); use `unique` to deal with tied values
(1:100)/101)))) %>% # 100 bins (about 30 obs. each)
summarise(residuals = mean(.resid),
lin_pred = mean(.fitted)) %>%
ggplot() +
geom_point(aes(x = lin_pred,
y = residuals))
knitr::opts_chunk$set(echo = TRUE)
# --- load libraries
library(tidyverse)
library(faraway)
library(broom)
# --- plot logistic regression; on probability scale
df <- tibble(x = lin_pred, # eta = \hat{\beta_0} + \hat{\beta_1}.x1 + \hat{\beta_2}.x2
y_hat = prob_pred, # y_hat = exp(eta) / (1 + exp(eta)) *transform log(odds) to probability scale
raw_resid = wcgs$y - prob_pred, # y - y_hat
actual_y = wcgs$y) # 0 & 1's
df %>%
ggplot() +
# fitted logistic regression
geom_line(aes(x = x,
y = y_hat),
size = 1.5) +
# actual y values (0 & 1)
geom_point(aes(x = x,
y = actual_y,
colour = factor(actual_y)),
alpha = 0.8) +
# draw residual line (from y to y_hat); for each x value
geom_segment(aes(x = x,
y = y_hat,
xend = x,
yend = actual_y,
colour = factor(actual_y)),
alpha = 0.1) +
theme_bw() +
# colour chd (red)// no chd(blue)
scale_colour_manual("chd",
values = c("blue", "red"),
labels = c("0: no chd", "1: chd")) +
# add axes labels & title
labs(x = latex2exp::TeX("$\\eta = \\beta_0 + \\beta_1.height + \\beta_2.cigs$"),
y = latex2exp::TeX("$\\hat{y} = \\frac{e^{\\eta}}{1+e^{\\eta}}$")) +
ggtitle("fitted logistic regression on probability scale")
# --- residuals against fitted values
df %>%
ggplot(aes(x = x,
y = raw_resid)) +
geom_point() +
theme_bw() +
labs(x = latex2exp::TeX("fitted values: $\\eta = \\beta_0 + \\beta_1.height + \\beta_2.cigs$"),
y = latex2exp::TeX("residuals: $y-\\hat{y}$"))
ggtitle("residual vs. fitted values")
knitr::opts_chunk$set(echo = TRUE)
# --- load libraries
library(tidyverse)
library(faraway)
library(broom)
qqnorm(residuals(lmod))
qqnorm(residuals(log_mod))
